var db = require('mongoskin').db('mongodb://localhost:27017/puzzle');


exports.getScore = function (callback) {
    db.collection('puzzles').find().toArray(function(err, result) {
        if (err) {
            throw err;
        }
        callback(result);
    });
	// TODO restrict to top 20 or something
};

exports.addPuzzle = function (user, callback) {
    db.collection('puzzles').insert({
		user: user
	}, function(err, result) {
        if (err) throw err;
        console.log('Puzzle ' + result._id + ' was inserted!');
        callback(result);
    });
	
};

exports.addWordToPuzzle = function (puzzleId, word, callback) {
    getPuzzle(puzzleId, function(puzzle) {
        if (!puzzle.words) {
            puzzle.words = [];
        }
        puzzle.words.push(word);
        
        db.collection('puzzles').update(puzzle, function(err, result) {
            if (err) throw err;
            console.log('Puzzle ' + puzzleId + ' was extended by a word!');
            callback(result);
        });
    })
};

function getPuzzle(puzzleId, callback) {
	db.collection('puzzles').findOne({ _id : puzzleId }, function(err, result) {
        if (err) throw err;
        callback(result);
    });
};
exports.getPuzzle = getPuzzle;